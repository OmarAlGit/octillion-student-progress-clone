<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student Progress Tracker (TV View)</title>
  <style>
    :root {
      /* Adjust these if you want to scale the sheet up/down on your TV */
      --sheet-scale: 1;      /* 1 = 100%, try 1.1 or 0.9 if needed */
      --bg: #0b0c0f;         /* nice dark background for TVs */
    }
    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      overflow: hidden;      /* no scrollbars around the frame */
    }
    .wrap {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
    }
    .iframe-frame {
      width: 100vw;
      height: 100vh;
      transform: scale(var(--sheet-scale));
      transform-origin: center center;
      /* When scaling up, hide any potential overflow (no bars) */
      overflow: hidden;
      border: none;
    }
    iframe {
      width: 100%;
      height: 100%;
      border: none;
      /* Display-only: block clicks so nobody fiddles with the sheet on the TV */
      pointer-events: none;
    }

    /* Optional: show a tiny “last updated” badge in a corner */
    .stamp {
      position: fixed;
      right: 10px;
      bottom: 8px;
      font: 12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: #aab1c2;
      opacity: 0.7;
      background: rgba(0,0,0,0.35);
      padding: 6px 8px;
      border-radius: 6px;
      user-select: none;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <iframe
      id="sheet"
      class="iframe-frame"
      referrerpolicy="no-referrer"
      sandbox="allow-same-origin allow-scripts allow-popups"
      allowfullscreen
      loading="eager"
      src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRTW5UzVfnAcBJdW9fSL7SXFc0wtUV5ftFWKaFExTPhq7FTv5QZ0rHqjs4sLlBnFHzCi0ThHMzV3rT_/pubhtml?gid=1926586971&single=true&widget=true&chrome=false">
    </iframe>
  </div>

  <div class="stamp" id="stamp">Loading…</div>

  <script>
    // Hard-refresh the published sheet every 2 minutes with a cache-buster.
    const IFRAME_ID = "sheet";
    const STAMP_ID = "stamp";
    const REFRESH_MS = 120_000; // 2 minutes

    const iframe = document.getElementById(IFRAME_ID);
    const stamp = document.getElementById(STAMP_ID);

    function updateStamp() {
      const d = new Date();
      // Show local time so staff can see it has refreshed
      stamp.textContent = "Last refresh: " + d.toLocaleString();
    }

    function reloadFrame() {
      // Keep the base URL clean, append a cache-busting param
      const base = iframe.dataset.base || iframe.src.split("#")[0].split("?")[0];
      const search = new URLSearchParams(
        (iframe.src.split("?")[1] || "").replace(/#.*/,'')
      );

      // Preserve existing params (&widget=true&chrome=false&gid=...)
      // and append a timestamp to avoid caching
      search.set("_t", Date.now().toString());

      // If you only want to show a certain range, you can also add:
      // search.set("range", "A1:Z200");

      const next = `${base}?${search.toString()}`;
      iframe.dataset.base = base;
      iframe.src = next;
      updateStamp();
    }

    // Initial stamp once the page finishes loading
    window.addEventListener('load', updateStamp);

    // First reload shortly after load to ensure fresh content, then every 2 mins
    setTimeout(reloadFrame, 2500);
    setInterval(reloadFrame, REFRESH_MS);
  </script>
</body>
</html>
